<div class="warning-text">
  <mat-icon>help_outline</mat-icon>
  <span>
      Les montants indiqués ci-dessous sont calculés sur base des transactions d'achat et de vente réalisée dans la période spécifiée
  et pour lesquels vous avez préciser que votre organisme de paiement n'a pas prélevé la taxe boursière automatiquement.
  </span>
</div>

@for(group of groups(); track group.taxRate) {
    <mat-card>
      <mat-card-title>
        Sur base d'un taux à {{ group.taxRate }}%
      </mat-card-title>
      <mat-card-content>
        <div class="tax-rate-summary">
          <span>Transactions : {{group.total.count}}</span>
          <span>Montant total : {{group.total.totalPrice | currency: 'EUR'}}</span>
          <span>Tax à payer :{{group.total.totalTaxAmount | currency: 'EUR'}}</span>
        </div>


        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              Visualiser les transactions
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div class="tax-rate-group">
            <table mat-table [dataSource]="group.transactions" class="mat-elevation-z8">

              <!-- Date Column -->
              <ng-container matColumnDef="date">
                <th mat-header-cell *matHeaderCellDef>Date</th>
                <td mat-cell *matCellDef="let row">{{ row.date }}</td>
              </ng-container>

              <!-- Price Column -->
              <ng-container matColumnDef="price">
                <th mat-header-cell *matHeaderCellDef>Price</th>
                <td mat-cell *matCellDef="let row">{{ row.price | currency: 'EUR' }}</td>
              </ng-container>

              <!-- Tax Amount Column -->
              <ng-container matColumnDef="taxAmount">
                <th mat-header-cell *matHeaderCellDef>Tax Amount</th>
                <td mat-cell *matCellDef="let row">{{ row.taxAmount | currency: 'EUR' }}</td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

              <!-- Ligne de total -->
              <tr class="total-row">
                <td><strong>Total ({{ group.total.count }} tx)</strong></td>
                <td>{{ group.total.totalPrice }}</td>
                <td>{{ group.total.totalTaxAmount }}</td>
              </tr>
            </table>
          </div>
        </mat-expansion-panel>
      </mat-card-content>
    </mat-card>

  }
